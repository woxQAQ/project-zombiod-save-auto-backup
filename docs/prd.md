# Project Zomboid Save Auto Backup Tool - Product Requirements Document (PRD)

## 1. 产品概述
### 1.1 背景
《僵尸毁灭工程》（Project Zomboid, PZ）是一款硬核生存模拟游戏，其核心机制之一是“永久死亡”且存档采用实时覆盖制。这意味着玩家一旦角色死亡或遭遇游戏 Bug，数周甚至数月的生存进度将瞬间归零。虽然这种机制增强了紧张感，但对于希望规避意外损失或进行实验性玩法的玩家来说，缺乏便捷的存档管理工具是一个显著痛点。

### 1.2 目标
开发一款基于 Tauri 的轻量级桌面工具，为 PZ 玩家提供自动化的存档备份与便捷的恢复（S/L）功能，旨在降低试错成本，提升游戏安全感，同时保持极低的学习成本和资源占用。

## 2. 用户角色
*   **生存玩家**：长期经营一个存档，极度厌恶因误操作或 Bug 导致的坏档。
*   **Mod 测试者**：频繁安装/卸载 Mod，需要快速回滚到“干净”的存档状态。
*   **新手玩家**：不熟悉游戏机制，需要“后悔药”来学习生存技巧。

## 3. 功能需求 (MVP)

### 3.1 存档路径管理
*   **自动检测**：
    *   应用启动时尝试自动识别操作系统的默认存档路径。
        *   Windows: `C:\Users\<User>\Zomboid\Saves`
        *   Mac: `~/Zomboid/Saves`
        *   Linux: `~/Zomboid/Saves`
*   **手动配置**：若自动检测失败或用户使用了非标准安装，允许手动选择“游戏存档源目录” (Root Saves Directory) 和“备份存储目录”。
*   **多模式支持与层级结构**：
    *   识别存档的二级目录结构：`Saves/<GameMode>/<SaveName>`。
    *   第一级目录为游戏模式（如 Sandbox, Apocalypse, Survivor, Multiplayer）。
    *   第二级目录才是具体的玩家存档。
    *   系统需扫描所有模式目录下的所有存档。

### 3.2 备份机制
*   **定时自动备份**：
    *   **开关**：用户可一键开启/关闭自动备份服务。
    *   **频率**：提供预设选项（每 5/15/30/60 分钟）或自定义分钟数。
    *   **触发逻辑**：后台静默运行，建议在检测到文件变动时才重置计时器（避免备份完全相同的空档期）。
*   **手动备份**：主界面提供醒目的“立即备份”按钮，用于关键节点（如外出探险前）的主动保存。
*   **备份命名**：
    *   格式：`{存档名称}_{YYYY-MM-DD}_{HH-mm-ss}`
    *   示例：`MySurvival_2023-10-27_14-30-00`

### 3.3 恢复机制 (Load)
*   **备份列表**：
    *   按时间倒序展示当前选中存档的所有备份记录。
    *   显示信息：备份时间点、文件大小、距今时长（如“10分钟前”）。
*   **一键恢复**：
    *   用户点击“恢复”按钮后，将指定备份文件夹的内容覆盖回游戏存档目录。
*   **安全防误触（Undo）**：
    *   **执行恢复操作前，系统必须强制对当前游戏存档进行一次临时快照（Pre-Restore Backup）。**
    *   如果用户恢复错了备份，可以通过这个快照撤销操作。

### 3.4 存储空间管理
*   **保留策略（GC）**：
    *   **按数量保留**：默认开启，保留最近 N 个备份（默认 10 个），超出的旧备份自动删除。
    *   **按时间保留**：（可选）保留最近 N 天的备份。
*   **磁盘保护**：当检测到备份盘剩余空间不足（如 < 1GB）时，停止自动备份并通知用户。

## 4. 非功能需求
*   **性能**：
    *   备份操作应使用异步 I/O，避免阻塞 UI 线程。
    *   内存占用应保持低位（< 100MB）。
*   **易用性**：
    *   UI 简洁直观，无需查看说明书即可理解“备份”与“恢复”操作。
    *   提供清晰的状态指示（如：上次备份时间、下次备份倒计时）。
*   **可靠性**：
    *   文件读写失败（如文件被游戏占用）时应有明确的错误提示，而不是静默失败。

## 5. UI/UX 规划概览

### 5.1 主界面 (Dashboard)
*   **顶部状态栏**：显示当前监控的存档路径，自动备份开关（Toggle），下次备份倒计时。
*   **左侧/顶部选择器**：如果检测到多个存档（角色），允许用户切换当前操作的存档对象。
*   **核心操作区**：
    *   巨大的“立即备份”按钮。
    *   “备份历史”列表区域：每一行包含时间、大小、恢复按钮、删除按钮。
*   **底部状态栏**：显示版本号、设置入口。

### 5.2 设置弹窗 (Settings)
*   源目录路径配置
*   备份存储路径配置
*   自动备份间隔设置
*   最大保留备份数量设置

## 6. 技术栈
*   **Core**: Rust (Tauri Backend) - 负责文件系统操作、定时任务、系统托盘（可选）。
*   **UI**: React + TypeScript + TailwindCSS/ChakraUI - 负责界面交互。
*   **State Management**: React Context 或 Zustand。

## 7. 未来规划 (Roadmap v2.0)
*   **存档元数据解析**：读取 `map_p.bin` 等文件，在备份列表中直接显示角色的生存天数、击杀僵尸数，方便区分。
*   **云同步**：对接 Google Drive / OneDrive API 实现异地容灾。
*   **差异增量备份**：对于大存档（数 GB），改用增量备份算法以节省空间。
*   **快捷键集成**：支持在游戏中按 `F5` 触发后台静默备份。
